.model small

.stack 100h

.data

startDX               dw  0
tempDX                dw  0
flagTemp              dw  0
flagStart             dw  0

maxCMDSize equ 127
cmd_size              db  ?
cmd_text              db  maxCMDSize + 2 dup(0)
sourcePath            db  129 dup (0)
tempSourcePath        db  128 dup (0)

;path                  db "kol.txt",0
destinationPath       db  "output.txt",0
extension             db "txt"
point2                db '.'
buf                   db  0
sourceID              dw  0
destinationID         dw  0

newLineSymbol         equ 0Dh
returnSymbol          equ 0Ah
endl                  equ 0

enteredString         db 200 dup("$")
enteredStringSize     dw 0

startProcessing       db "Processing started",                                                '$'
startText             db  "Program is started",                                               '$'
badCMDArgsMessage     db  "Bad command-line arguments.",                                      '$'
badSourceText         db  "Open error",                                                       '$'
fileNotFoundText      db  "File not found",                                                   '$'
endText               db  0Dh,0Ah,"Program is ended",                                         '$'
errorReadSourceText   db  "Error reading from source file",                                   '$'

.code

scanf MACRO string
push ax
push dx

lea dx, string
mov ah, 0Ah
int 21h

pop dx
pop ax
endm

println MACRO info          ;
push ax                 ;
push dx                 ;
;
mov ah, 09h             ; –ö–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∞
lea dx, info            ; –ó–∞–≥—Ä—É–∑–∫–∞ –≤ dx —Å–º–µ—â–µ–Ω–∏—è –≤—ã–≤–æ–¥–∏–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
int 21h                 ; –í—ã–∑–æ–≤ –ø—Ä–µ—Ä–≤—ã–≤–∞–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞
;
mov dl, 0Ah             ; –°–∏–º–≤–æ–ª –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
mov ah, 02h             ; –ö–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞
int 21h                 ; –í—ã–∑–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
;
mov dl, 0Dh             ; –°–∏–º–≤–æ–ª –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
mov ah, 02h             ;
int 21h                 ;
;
pop dx                  ;
pop ax                  ;
ENDM

strcpy MACRO destination, source, count       ;–ú–∞–∫—Ä–æ—Å, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ source –≤ destination –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
push cx
push di
push si

xor cx, cx

mov cl, count
lea si, source
lea di, destination

rep movsb

pop si
pop di
pop cx
ENDM

incrementTempPos MACRO num          ;–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º tempDX, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —ç—Ç–æ
add tempDX, num
jo overflowTempPos
jmp endIncrementTempPos

overflowTempPos:
inc flagTemp
add tempDX, 32769
jmp endIncrementTempPos

endIncrementTempPos:

endm

incrementStartPos proc          ; –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º startDX, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —ç—Ç–æ
push ax

mov ax, tempDX
add startDX, ax
jo overflow
jmp endIncrement

overflow:
inc flagStart
add startDX, 32769

endIncrement:
mov ax, flagTemp
add flagStart, ax

pop ax
ret
endp

fseekCurrent MACRO settingPos
push ax
push cx
push dx

mov ah, 42h                 ; –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ ah –∫–æ–¥ 42h - —Ñ-—Ü–∏—è DOS —É—Å—Ç–∞–≤–Ω–æ–∫–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è —Ñ–∞–π–ª–∞
mov al, 1                   ; 1 - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
mov cx, 0                   ; –û–±–Ω—É–ª—è–µ–º cx,
mov dx, settingPos            ; –û–±–Ω—É–ª—è–µ–º dx, —Ç.–µ –ø—Ä–µ–º–µ—â–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ 0 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞ (cx*65536)+dx
int 21h                     ; –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è DOS –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

pop dx
pop cx
pop ax
ENDM

fseek MACRO fseekPos
push ax
push cx
push dx

mov ah, 42h                 ; –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ ah –∫–æ–¥ 42h - —Ñ-—Ü–∏—è DOS —É—Å—Ç–∞–≤–Ω–æ–∫–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è —Ñ–∞–π–ª–∞
mov al, 0                     ; 0 - –∫–æ–¥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª—è –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
mov cx, 0                   ; –û–±–Ω—É–ª—è–µ–º cx,
mov dx, fseekPos            ; –û–±–Ω—É–ª—è–µ–º dx, —Ç.–µ –ø—Ä–µ–º–µ—â–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ 0 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞ (cx*65536)+dx
int 21h                     ; –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è DOS –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

pop dx
pop cx
pop ax

ENDM

setPointer proc                 ; –§—É–Ω–∫—Ü–∏—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∞—è —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ —Ñ–∞–π–ª–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é, –∑–∞–≤–∏—Å—è—â—É—é –æ—Ç startDX –∏ flagStart
push cx
push bx

mov bx, sourceID
fseek startDX

cmp flagStart, 0
je endSetPos
xor cx, cx
mov cx, flagStart

setPos1:
mov bx, sourceID
fseekCurrent 32767
loop setPos1

endSetPos:

pop bx
pop cx
ret
endp

main:
mov ax, @data           ; –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
mov es, ax              ;
;
xor ch, ch              ; –û–±–Ω—É–ª—è–µ–º ch
mov cl, ds:[80h]        ; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ —Å—Ç—Ä–æ–∫–∏, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
mov bl, cl
mov cmd_size, cl         ; –í cmd_size –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª–∏–Ω—É –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
dec bl                  ; –£–º–µ–Ω—å—à–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∞ 1, —Ç.–∫. –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –ø—Ä–æ–±–µ–ª
mov si, 81h             ; –°–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫–∏
lea di, tempSourcePath

rep movsb               ; –ó–∞–ø–∏—Å–∞—Ç—å –≤ —è—á–µ–π–∫—É –∞–¥—Ä–µ—Å–æ–º ES:DI –±–∞–π—Ç –∏–∑ —è—á–µ–π–∫–∏ DS:SI

mov ds, ax              ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ ds –¥–∞–Ω–Ω—ã–µ
mov cmd_size, bl

mov cl, bl
lea di, cmd_text
lea si, tempSourcePath
inc si
rep movsb

println startText       ; –í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ –æ –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã

call parseCMD           ; –í—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
cmp ax, 0
jne endMain                ; –ï—Å–ª–∏ ax != 0, —Ç.–µ. –ø—Ä–∏ –≤—ã–ø–æ–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ - –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É

call openFiles          ; –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
cmp ax, 0
jne endMain

scanf enteredString         ; –í–≤–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤
xor ax, ax                  ; –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –¥–ª–∏–Ω—É –≤–≤–µ–¥–µ–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
mov al, [enteredString+1]
mov enteredStringSize, ax

cmp enteredStringSize, 0    ; –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–∞–π–ª, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä–∞—à–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
je endMain
println startProcessing
call processingFile

endMain:
println endText             ; –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã

mov ah, 4Ch                 ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ ah –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
int 21h                     ; –í—ã–∑–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è DOS –¥–ª—è –µ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

parseCMD proc
xor ax, ax
xor cx, cx

cmp cmd_size, 0             ; –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω, —Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ notFound
je notFound

mov cl, cmd_size

lea di, cmd_text
mov al, cmd_size
add di, ax
dec di

findPoint:                      ; –ò—â–µ–º —Ç–æ—á–∫—É —Å –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞, —Ç.–∫. –ø–æ—Å–ª–µ –Ω–µ—ë –∏–¥–µ—Ç —Ä–∞–∑—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
mov al, '.'
mov bl, [di]
cmp al, bl
je pointFound
dec di
loop findPoint

notFound:                       ; –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤—ã–≤–æ–¥–∏–º badCMDArgsMessage –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
println badCMDArgsMessage
mov ax, 1
ret

pointFound:                     ; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ 3, —Ç.–∫. "txt", –µ—Å–ª–∏ –æ—Ç–ª–∏—á–Ω–æ –æ—Ç —ç—Ç–æ–≥–æ => —Ñ–∞–π–ª –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç
mov al, cmd_size
sub ax, cx
cmp ax, 3

jne notFound


xor ax, ax
lea di, cmd_text
lea si, extension
add di, cx

mov cx, 3

repe cmpsb                  ; –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–æ —Å—Ç—Ä–æ–∫–æ–π Extension —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –≤—Å—ë —Å–æ–≤–ø–∞–ª–æ - –∫–æ–ø–∏—Ä—É–µ–º –∞–¥—Ä–µ—Å —Ñ–∞–π–ª–∞ –≤ sourcePath
jne notFound

strcpy sourcePath, cmd_text, cmd_size
mov ax, 0
ret
endp

openFiles PROC
push bx
push dx
push si

mov ah, 3Dh                    ; –§—É–Ω–∫—Ü–∏—è 3Dh - –æ—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
mov al, 02h                    ; –†–µ–∂–∏–º –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞ - —á—Ç–µ–Ω–∏–µ
lea dx, sourcePath          ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ dx –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
int 21h

jb badOpenSource            ; –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è, —Ç–æ –ø—Ä—ã–≥–∞–µ–º –≤ badOpenSource

mov sourceID, ax            ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ sourceId –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ ax, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞

mov ah, 3Ch                 ; –§—É–Ω–∫—Ü–∏—è 3Ch - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
xor cx, cx
lea dx, destinationPath
int 21h

jb badOpenSource

mov ah, 3Dh
mov al, 02h
lea dx, destinationPath
int 21h

jb badOpenSource

mov destinationID, ax

mov ax, 0                    ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ ax 0, —Ç.–µ. –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–µ –ø—Ä–æ–∏–∑—à–ª–æ
jmp endOpenProc                ; –ü—Ä—ã–≥–∞–µ–º –≤ endOpenProc –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

badOpenSource:
println badSourceText       ; –í—ã–≤–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

cmp ax, 02h                 ; –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º ax —Å 02h
jne errorFound              ; –ï—Å–ª–∏ ax != 02h file error, –ø—Ä—ã–≥–∞–µ–º –≤ errorFound

println fileNotFoundText    ; –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

jmp errorFound              ; –ü—Ä—ã–≥–∞–µ–º –≤ errorFound

errorFound:
mov ax, 1

endOpenProc:
pop si
pop dx
pop bx
ret
ENDP

processingFile proc             ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞, –±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

for1:
mov tempDX, 0               ; –û–±–Ω—É–ª—è–µ–º tempDX –∏ flagTemp
mov flagTemp, 0

mov bx, sourceID
call setPointer             ; –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏

lea si, enteredString       ; –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—á–∞–ª–æ –≤–≤–µ–¥–µ–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
add si, 2

for2:
call readSymbolFromFile     ; –°—á–∏—Ç—ã–≤–∞–µ–º —Å–∏–º–≤–æ–ª —Å —Ñ–∞–π–ª–∞

incrementTempPos 1

cmp ax, 0                   ; –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Å—á–∏—Ç–∞–ª–∏ => –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
je endFileGG
cmp [buf], 0                ; –ï—Å–ª–∏ —Å—á–∏—Ç–∞–ª–∏ NULL => –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
je endFileGG

cmp [buf], returnSymbol     ; –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏: cret, new line, \0
je  endString
cmp [buf], newLineSymbol
je  endString
cmp [buf], endl
je  endString

xor ax, ax
xor bx, bx

mov al, buf
mov bl, [si]

cmp al, bl                  ; –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª–∞ —Ä–∞–≤–Ω—ã –∏–¥–µ–º –≤ doSomething
je doSomething

jmp for2

endString:
call incrementStartPos       ; –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
jmp for1                     ; –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É


doSomething:
inc si

xor bx, bx
mov bl, [si]

cmp bl, newLineSymbol        ; –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≤–≤–µ–¥–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, —Ç–æ –≤—Å–µ —Å–∏–º–≤–æ–ª–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è
je stringUdov
cmp bl, returnSymbol
je stringUdov
cmp bl, endl
je stringUdov

mov tempDX, 0
mov flagTemp, 0

mov bx, sourceID
call setPointer

jmp for2

stringUdov:
call writeStr                ; –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ output.txt
jmp for1

endFileGG:

ret
endp

writeStr proc
mov bx, sourceID
call setPointer

mov bx, destinationID

mov tempDX, 1
mov flagTemp, 0

while1:
call readSymbolFromFile
call incrementStartPos

cmp ax, 0
je endAll

cmp [buf], returnSymbol
je  endWrite
cmp [buf], endl
je  endAll

mov ah, 40h
mov cx, 1
lea dx, buf
int 21h

jmp while1

endWrite:
mov ah, 40h
mov cx, 1
lea dx, buf
int 21h

endAll:

ret
endp

readSymbolFromFile proc
push bx
push dx

mov ah, 3Fh                     ; –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ ah –∫–æ–¥ 3Fh - –∫–æ–¥ —Ñ-—Ü–∏–∏ —á—Ç–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
mov bx, sourceID                ; –í bx –∑–∞–≥—Ä—É–∂–∞–µ–º ID —Ñ–∞–π–ª–∞, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–±–∏—Ä–∞–µ–º—Å—è —Å—á–∏—Ç—ã–≤–∞—Ç—å
mov cx, 1                       ; –í cx –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç—ã–≤–∞–µ–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
lea dx, buf                     ; –í dx –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–º–µ—â–µ–Ω–∏—è –±—É—Ñ—Ñ–µ—Ä–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞
int 21h                         ; –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ-—Ü–∏–∏

jnb successfullyRead            ; –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è —Å—á—Ç–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ - –ø—Ä—ã–≥–∞–µ–º –≤ goodRead

println errorReadSourceText     ; –ò–Ω–∞—á–µ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —á—Ç–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
mov ax, 0

successfullyRead:

pop dx
pop bx

ret
endp

end main



; [SOURCE]: C:\Users\art.plhvsk\Desktop\ œËﬂœ\.asm À–\5 lab\5lab.asm
